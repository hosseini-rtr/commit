{% extends "posts/layout.html" %}

{% block body %}
  {% if user.is_authenticated %}
    <!-- Following Posts Header -->
    <div class="d-flex align-items-center mb-4">
      <h2 class="mb-0">
        <i class="bi bi-people me-2"></i>
        Following Posts
      </h2>
    </div>

    <!-- Post Form -->
    <div class="post-form">
      <div class="post-form-header">
        <h5 class="post-form-title">
          <i class="bi bi-pencil-square me-2"></i>
          Create a Post
        </h5>
      </div>
      <div class="post-form-body">
        {% include 'posts/components/post_form.html' %}
      </div>
    </div>

    <!-- Following Posts Feed -->
    <div class="posts-feed">
      {% if not posts_of_the_page %}
        <div class="text-center py-5">
          <i class="bi bi-people display-1 text-muted mb-3"></i>
          <h3 class="text-muted">No posts from people you follow!</h3>
          <p class="text-muted">Follow some people to see their posts here.</p>
          <a href="{% url 'posts:index' %}" class="btn btn-outline-primary">
            <i class="bi bi-house-door me-2"></i>
            View All Posts
          </a>
        </div>
      {% endif %}

      {% for post in posts_of_the_page %}
        <div class="post-card">
          {% include "posts/components/posts.html" with post=post %}
        </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if posts_of_the_page.has_other_pages %}
    <nav aria-label="Following posts pagination">
      <ul class="pagination">
        {% if posts_of_the_page.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ posts_of_the_page.previous_page_number }}" aria-label="Previous">
              <i class="bi bi-chevron-left"></i>
              <span class="d-none d-sm-inline">Previous</span>
            </a>
          </li>
        {% endif %}

        {% for num in posts_of_the_page.paginator.page_range %}
          {% if posts_of_the_page.number == num %}
            <li class="page-item active">
              <span class="page-link">{{ num }}</span>
            </li>
          {% elif num > posts_of_the_page.number|add:'-3' and num < posts_of_the_page.number|add:'3' %}
            <li class="page-item">
              <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
          {% endif %}
        {% endfor %}

        {% if posts_of_the_page.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ posts_of_the_page.next_page_number }}" aria-label="Next">
              <span class="d-none d-sm-inline">Next</span>
              <i class="bi bi-chevron-right"></i>
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  {% else %}
    <!-- Not Authenticated Message -->
    <div class="welcome-section">
      <i class="bi bi-lock display-1 text-muted mb-3"></i>
      <h2 class="welcome-title">Authentication Required</h2>
      <p class="welcome-subtitle">Please log in to view posts from people you follow.</p>
      <div class="welcome-actions">
        <a href="{% url 'users:login' %}" class="btn btn-primary">
          <i class="bi bi-box-arrow-in-right me-2"></i>
          Log In
        </a>
        <a href="{% url 'users:register' %}" class="btn btn-outline-primary">
          <i class="bi bi-person-plus me-2"></i>
          Sign Up
        </a>
      </div>
    </div>
  {% endif %}
{% endblock %}