{% extends "posts/layout.html" %}
{% load static %}

{% block body %}
  {% if user.is_authenticated %}
    <!-- Profile Section -->
    <div class="profile-section">
      <img src="{% static 'social_network/profile.png' %}" alt="Profile" class="profile-avatar">
      <h2 class="profile-name">
        {% if user == user_profile %}Hi, {% else %}It's {% endif %}{{ username }}
      </h2>
      
      <!-- Profile Stats -->
      <div class="profile-stats">
        <div class="stat-item">
          <span class="stat-number">{{ posts_of_the_page|length }}</span>
          <span class="stat-label">Posts</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ following.count }}</span>
          <span class="stat-label">Following</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ followers.count }}</span>
          <span class="stat-label">Followers</span>
        </div>
      </div>

      <!-- Follow/Unfollow Button -->
      {% if user != user_profile %}
        <div class="mt-3">
          {% if isFollowing %}
            <form method="POST" action="{% url 'social:unfollowing' %}" class="d-inline">
              {% csrf_token %}
              <input type="hidden" value="{{ username }}" name="username" />
              <button type="submit" class="btn btn-outline-danger">
                <i class="bi bi-person-x me-2"></i>
                Unfollow
              </button>
            </form>
          {% else %}
            <form method="POST" action="{% url 'social:following' %}" class="d-inline">
              {% csrf_token %}
              <input type="hidden" value="{{ username }}" name="username" />
              <button type="submit" class="btn btn-outline-primary">
                <i class="bi bi-person-plus me-2"></i>
                Follow
              </button>
            </form>
          {% endif %}
        </div>
      {% endif %}
    </div>

    <!-- Post Form for Own Profile -->
    {% if user == user_profile %}
    <div class="post-form">
      <div class="post-form-header">
        <h5 class="post-form-title">
          <i class="bi bi-pencil-square me-2"></i>
          Create a Post
        </h5>
      </div>
      <div class="post-form-body">
        {% include 'posts/components/post_form.html' %}
      </div>
    </div>
    {% endif %}

    <!-- User's Posts -->
    <div class="posts-feed">
      <h3 class="mb-4">
        <i class="bi bi-person-circle me-2"></i>
        {{ username }}'s Posts
      </h3>

      {% if not posts_of_the_page %}
        <div class="text-center py-5">
          <i class="bi bi-inbox display-1 text-muted mb-3"></i>
          <h4 class="text-muted">No posts yet!</h4>
          {% if user == user_profile %}
            <p class="text-muted">Start sharing your thoughts!</p>
          {% else %}
            <p class="text-muted">{{ username }} hasn't posted anything yet.</p>
          {% endif %}
        </div>
      {% endif %}

      {% for post in posts_of_the_page %}
        <div class="post-card">
          {% include "posts/components/posts.html" with post=post %}
        </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if posts_of_the_page.has_other_pages %}
    <nav aria-label="Profile posts pagination">
      <ul class="pagination">
        {% if posts_of_the_page.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ posts_of_the_page.previous_page_number }}" aria-label="Previous">
              <i class="bi bi-chevron-left"></i>
              <span class="d-none d-sm-inline">Previous</span>
            </a>
          </li>
        {% endif %}

        {% for num in posts_of_the_page.paginator.page_range %}
          {% if posts_of_the_page.number == num %}
            <li class="page-item active">
              <span class="page-link">{{ num }}</span>
            </li>
          {% elif num > posts_of_the_page.number|add:'-3' and num < posts_of_the_page.number|add:'3' %}
            <li class="page-item">
              <a class="page-link" href="?page={{ num }}">{{ num }}</a>
            </li>
          {% endif %}
        {% endfor %}

        {% if posts_of_the_page.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ posts_of_the_page.next_page_number }}" aria-label="Next">
              <span class="d-none d-sm-inline">Next</span>
              <i class="bi bi-chevron-right"></i>
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
    {% endif %}
  {% endif %}
{% endblock %}
